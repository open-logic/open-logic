name: AWS-TEST
run-name: ${{ github.actor }} triggered AWS-TEST

# Set the permissions for the workflow
permissions:
  checks: write
  pull-requests: write

#Set Triggers
on:
  workflow_dispatch:
  pull_request:
  
#Jobs  
  start-instance:
    runs-on: ubuntu-latest
    steps:
      #Run Simulation
      - name: Start Instance
        uses: ./.github/actions/start-aws-instance
        with:
          instance_id: i-08d60c6d6d93c636b
          region: eu-central-1

  do-something:
    runs-on: [self-hosted, aws]
    needs: start-instance
    steps:
      # Checkout the repository
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          submodules: true
      # Add local tools to path
      - name: Add local tools
        run: |
          echo $LOCAL_TOOLS >> $GITHUB_PATH
      # Placeholder
      - name: Do work
        run: |
          ifconfig
          echo "Instance ENV"
          printenv
          echo "pwd"
          pwd
          ls
          cd ./doc/tutorials/VivadoTutorial/Files
          vivado -mode batch -source scripted_build.tcl

  # Stopping the instance is not required (it stops automatically
  # when it is unused for some time, controlled by AWS alarm)